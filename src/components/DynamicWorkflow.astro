---
// src/components/DynamicWorkflow.astro
import ImageUploader from './ImageUploader.astro';
import ImageEditor from './ImageEditor.astro';
import PromptInput from './PromptInput.astro';
import ToggleWithText from './ToggleWithText.astro';
import { getTranslator } from '@gudupao/astro-i18n';

interface WorkflowParam {
 node_id: string;
  title: string;
  class_type: string;
}

interface Props {
  params: WorkflowParam[];
}

const { params = [] } = Astro.props;

// Get language from params or cookie
const lang = Astro.params.lang || Astro.cookies.get('lang')?.value || 'en';
const t = getTranslator(lang);
---

<!-- Image Editor Modal -->
<ImageEditor />

<div class="workflow-container">
  {
    params.map((param) => (
      <div class="component-wrapper">
        {(() => {
          if (param.class_type === 'LoadImageOutput') {
            return <ImageUploader />;
          } else if (param.class_type === 'Text') {
            return <PromptInput placeholder={param.title} />;
          } else if (param.class_type === 'Switch any [Crystools]') {
            return <ToggleWithText text={param.title} />;
          } else {
            return (
              <div class="unknown-component">
                <p>{t('dynamicworkflow.unknownComponent')}: {param.class_type}</p>
                <p>{t('dynamicworkflow.nodeId')}: {param.node_id}</p>
                <p>{t('dynamicworkflow.title')}: {param.title}</p>
              </div>
            );
          }
        })()}
      </div>
    ))
  }
</div>

<style>
  .workflow-container {
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
    padding: 1.5rem;
    width: 100%;
    max-width: 600px;
    margin: 0 auto;
  }

  .component-wrapper {
    display: flex;
    justify-content: center;
  }

  .unknown-component {
    padding: 1.5rem;
    background-color: #f8f9fa;
    border: 1px solid #dee2e6;
    border-radius: 0.75rem;
    color: #495057;
  }
</style>