---
// src/components/AdminSidebar.astro
import LanguageSwitcher from './LanguageSwitcher.astro';
import ThemeSwitcher from './ThemeSwitcher.astro';

// Define props interface
interface Props {
  me?: any;
}

const { me } = Astro.props as Props;
---
<aside>
  <div class="sidebar-header">
    <svg width="40" height="40" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
      <path d="M12 2l7 4v6c0 5-7 10-7 10s-7-5-7-10V6l7-4z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path>
      <path d="M12 8v4" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path>
    </svg>
    <h2>管理面板</h2>
  </div>
  <nav>
    <ul>
      <li><a href="/admin" class="nav-link" data-path="/admin">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M3 7v10a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2H5a2 2 0 00-2-2z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path>
          <path d="M8 5a2 2 0 012-2h4a2 2 0 012 2v2H8V5z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path>
        </svg>
        <span>仪表板</span>
      </a></li>
      <li><a href="/admin/overview" class="nav-link" data-path="/admin/overview">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path>
        </svg>
        <span>管理概览</span>
      </a></li>
      <li><a href="/admin/users" class="nav-link" data-path="/admin/users">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path>
        </svg>
        <span>用户管理</span>
      </a></li>
      <li><a href="/admin/workflows" class="nav-link" data-path="/admin/workflows">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path>
        </svg>
        <span>工作流管理</span>
      </a></li>
      <li><a href="/admin/groups" class="nav-link" data-path="/admin/groups">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M12 4.5c-4.418 0-8 3.358-8 7.5 0 1.5.483 2.87 1.284 3.97L12 21l6.716-5.03C19.517 14.87 20 13.5 20 12c0-4.142-3.582-7.5-8-7.5zm0 11a3.5 3.5 0 110-7 3.5 0 010 7z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path>
        </svg>
        <span>身份组管理</span>
      </a></li>
      <li><a href="/admin/history" class="nav-link" data-path="/admin/history">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path>
        </svg>
        <span>执行历史</span>
      </a></li>
      <li><a href="/admin/codes" class="nav-link" data-path="/admin/codes">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M10.5 8.25L13.5 12.75L10.5 17.25" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path>
          <path d="M12 21c4.97 0 9-4.03 9-9s-4.03-9-9-9-9 4.03-9 9 4.03 9 9 9z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path>
        </svg>
        <span>授权码管理</span>
      </a></li>
      <li><a href="/" class="nav-link" data-path="/">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M3 9l9-7 9 7v11a2 2 0 01-2 2H5a2 2 0 01-2-2V9z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path>
          <path d="M9 22V12h6v10" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path>
        </svg>
        <span>返回主界面</span>
      </a></li>
    </ul>
  </nav>
  <div class="sidebar-controls">
    <div class="theme-switcher-container">
      <ThemeSwitcher size="medium" showLabel={true} />
    </div>
    <div class="language-switcher-container">
      <LanguageSwitcher pathBasedRouting={false} />
    </div>
  </div>
</aside>

<style>
  aside {
    position: fixed;
    top: 0;
    left: 0;
    width: 300px; /* Slightly wider for admin panel */
    height: 100vh;
    padding: 25px;
    display: flex;
    flex-direction: column;
    gap: 40px;
    z-index: 1000;

    /* Glassmorphism styles with theme support */
    background: var(--bg-sidebar);
    backdrop-filter: blur(12px);
    -webkit-backdrop-filter: blur(12px);
    border-right: 1px solid var(--border-color);
    box-shadow: 0 4px 30px var(--shadow-light);
    transition: all 0.3s ease;
  }

  .sidebar-header {
    display: flex;
    align-items: center;
    gap: 15px;
  }

  .sidebar-header svg {
    color: var(--accent-color);
    transition: color 0.3s ease;
  }

  .sidebar-header h2 {
    margin: 0;
    font-size: 1.5rem;
    color: var(--text-primary);
    transition: color 0.3s ease;
  }

  nav ul {
    list-style: none;
    padding: 0;
    margin: 0;
    display: flex;
    flex-direction: column;
    gap: 10px;
  }

  nav a {
    display: flex;
    align-items: center;
    gap: 15px;
    padding: 12px 15px;
    border-radius: 8px;
    text-decoration: none;
    color: var(--text-primary);
    font-size: 1.1rem;
    font-weight: 500;
    transition: all 0.3s ease;
  }

  nav a:hover,
  nav a.active {
    background-color: rgba(59, 130, 246, 0.1);
    color: var(--accent-color);
  }

  nav a svg {
    transition: all 0.3s ease;
    color: currentColor;
  }

  .sidebar-controls {
    margin-top: auto;
    display: flex;
    flex-direction: column;
    gap: 20px;
    padding: 20px 0;
  }

  .theme-switcher-container,
  .language-switcher-container {
    display: flex;
    justify-content: center;
  }

  /* Mobile responsiveness */
  @media (max-width: 768px) {
    aside {
      position: fixed;
      top: 0;
      left: 0;
      width: 280px;
      padding: 20px;
      gap: 30px;
      z-index: 1000;
    }

    .sidebar-header h2 {
      font-size: 1.3rem;
    }

    nav a {
      font-size: 1rem;
      padding: 10px 12px;
    }

    .sidebar-controls {
      gap: 15px;
      padding: 15px 0;
    }
  }
</style>

<script>
  // Navigation highlighting
  function updateActiveNavigation() {
    const currentPath = window.location.pathname;
    const navLinks = document.querySelectorAll('.nav-link');

    navLinks.forEach(link => {
      const linkPath = link.getAttribute('data-path');
      if (linkPath && (
          currentPath === linkPath ||
          (linkPath === '/admin/overview' && (currentPath === '/admin/overview' || currentPath === '/admin/overview/')) ||
          (linkPath !== '/admin/overview' && currentPath.startsWith(linkPath))
        )) {
        link.classList.add('active');
      } else {
        link.classList.remove('active');
      }
    });
  }

  // Update navigation on page load
  document.addEventListener('DOMContentLoaded', updateActiveNavigation);

  // Update navigation when navigating (for SPAs)
  window.addEventListener('popstate', updateActiveNavigation);
</script>